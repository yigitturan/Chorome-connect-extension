<div class="chat-container">
  <div #scrollContainer class="messages">
    @for (message of messages; track message) {
      <div
        class="message"
        [ngClass]="{
          sent: message.username === currentUsername,
          received: message.username !== currentUsername
        }"
      >
        @if (message.username !== currentUsername) {
          <span
            class="username"
            [style.color]="getUsernameColor(message.username)"
          >
            {{ message.username }}
          </span>
        }
        @if (message.text) {
          <div class="text">{{ message.text }}</div>
        }
        @if (message.photoUrl) {
          <img class="photo" [src]="message.photoUrl" alt="Sent photo" />
        }
        <span class="timestamp">{{ formatTimestamp(message.createdAt) }}</span>
      </div>
    }
  </div>

  <div class="chat-input">
    <input
      [(ngModel)]="newMessage"
      type="text"
      placeholder="Type your message..."
      (keydown.enter)="sendMessage()"
    />
    <button (click)="sendMessage()" [disabled]="isSending || !newMessage.trim()">Send</button>
    <button (click)="startCamera()" [disabled]="isCapturingPhoto">Open Camera</button>
  </div>

  @if (isCapturingPhoto) {
    <div class="webcam-container">
      <video #video autoplay playsinline></video>
      <div class="camera-controls">
        <button (click)="capturePhoto()">Take Photo</button>
        <button (click)="stopCamera()">Cancel</button>
      </div>
    </div>
  }
</div>
